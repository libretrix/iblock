# Контекст 1С-Битрикс для разработки библиотеки

## Основные концепции 1С-Битрикс

### Информационные блоки (IBlocks)
Информационные блоки - это основная структура для хранения контента в Битрикс:

- **Элементы** - отдельные записи в информационном блоке
- **Свойства** - дополнительные поля элементов
- **Разделы** - категории для группировки элементов
- **Типы информационных блоков** - классификаторы ИБ

### Типичная структура данных
```
Тип ИБ
├── Информационный блок
│   ├── Раздел
│   │   ├── Элемент
│   │   │   ├── Свойства элемента
│   │   │   └── Поля элемента
│   │   └── Подраздел
│   └── Элемент без раздела
```

## Ключевые сущности

### Элемент информационного блока
- `ID` - уникальный идентификатор
- `NAME` - название
- `CODE` - символьный код
- `ACTIVE` - активность
- `SORT` - порядок сортировки
- `DATE_CREATE` - дата создания
- `TIMESTAMP_X` - дата изменения
- `IBLOCK_ID` - ID информационного блока
- `IBLOCK_SECTION_ID` - ID раздела

### Свойства элемента
- `ID` - ID свойства
- `CODE` - символьный код свойства
- `NAME` - название свойства
- `PROPERTY_TYPE` - тип свойства (S, N, F, L, E, G)
- `MULTIPLE` - множественное
- `IS_REQUIRED` - обязательное
- `VALUES` - значения для списков

### Раздел информационного блока
- `ID` - уникальный идентификатор
- `NAME` - название
- `CODE` - символьный код
- `IBLOCK_ID` - ID информационного блока
- `IBLOCK_SECTION_ID` - ID родительского раздела
- `DEPTH_LEVEL` - уровень вложенности

## API Битрикс для работы с ИБ

### Основные классы
- `CIBlock` - работа с информационными блоками
- `CIBlockElement` - работа с элементами
- `CIBlockSection` - работа с разделами
- `CIBlockProperty` - работа со свойствами

### Типичные операции
- Получение списка элементов/разделов
- Добавление/обновление/удаление
- Фильтрация и сортировка
- Работа со свойствами

## Архитектурные проблемы стандартного подхода

### Нарушения Clean Architecture
1. **Сильная связность** - бизнес-логика смешана с инфраструктурой
2. **Глобальные зависимости** - использование глобальных функций и классов
3. **Отсутствие типизации** - массивы вместо объектов
4. **Нарушение SRP** - классы делают слишком много

### Проблемы тестирования
- Зависимость от глобального состояния
- Сложность мокирования API Битрикс
- Отсутствие интерфейсов для абстракции

## Цели библиотеки libretrix/iblock

### Доменные сущности
```
Domain/
├── Iblock/           # Информационный блок
├── IblockElement/    # Элемент ИБ
├── IblockSection/    # Раздел ИБ
├──  /   # Свойство ИБ
└── IblockType/       # Тип ИБ
```

### Применение принципов Clean Architecture
1. **Domain Layer** - чистые бизнес-сущности
2. **Application Layer** - use cases и сервисы
3. **Infrastructure Layer** - адаптеры для API Битрикс
4. **Interface Layer** - контроллеры и представления

### Преимущества подхода
- **Тестируемость** - изоляция бизнес-логики
- **Поддерживаемость** - четкие границы ответственности
- **Гибкость** - возможность замены реализации
- **Типизация** - строгая типизация данных

## Ограничения и особенности

### Совместимость с Битрикс
- Библиотека должна работать в контексте Битрикс
- Сохранение обратной совместимости
- Использование стандартных ID и кодов

### Производительность
- Минимизация накладных расходов
- Эффективное кэширование
- Оптимизация запросов к БД

### Миграция
- Постепенный переход со стандартного API
- Совместимость с существующим кодом
- Инструменты для миграции данных